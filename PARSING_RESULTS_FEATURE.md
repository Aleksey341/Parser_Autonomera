# üéØ –§—É–Ω–∫—Ü–∏—è: –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–∞—Ä—Å–∏–Ω–≥–∞ —Å –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ –ë–î

–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –Ω–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –í–°–ï –¥–∞–Ω–Ω—ã–µ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö –ø–∞—Ä—Å–∏–Ω–≥–∞.

---

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å](#—á—Ç–æ-–∏–∑–º–µ–Ω–∏–ª–æ—Å—å)
2. [–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç](#–∫–∞–∫-—ç—Ç–æ-—Ä–∞–±–æ—Ç–∞–µ—Ç)
3. [API –ø—Ä–∏–º–µ—Ä—ã](#api-–ø—Ä–∏–º–µ—Ä—ã)
4. [–ü—Ä–∏–º–µ—Ä—ã –¥–∞–Ω–Ω—ã—Ö](#–ø—Ä–∏–º–µ—Ä—ã-–¥–∞–Ω–Ω—ã—Ö)
5. [–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è](#–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è)

---

## –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å?

### –†–∞–Ω—å—à–µ (—Å—Ç–∞—Ä–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ)

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–ù–∞—á–∞—Ç—å –ø–∞—Ä—Å–∏–Ω–≥"
         ‚Üì
–ü–∞—Ä—Å–µ—Ä —Å–∫—Ä–µ–π–ø–∏—Ç —Å–∞–π—Ç (5000 –æ–±—ä—è–≤–ª–µ–Ω–∏–π)
         ‚Üì
–†–µ–∑—É–ª—å—Ç–∞—Ç: —Ç–æ–ª—å–∫–æ 5000 —Å–ø–∞—Ä—Å–µ–Ω–Ω—ã—Ö –æ–±—ä—è–≤–ª–µ–Ω–∏–π
           (—Ç–æ —á—Ç–æ –±—ã–ª–æ –≤ –ø–∞–º—è—Ç–∏ –ø–∞—Ä—Å–µ—Ä–∞)
         ‚Üì
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç: —á—Ç–æ –ø–∞—Ä—Å–µ—Ä —Å–æ–±—Ä–∞–ª —Å–µ–π—á–∞—Å
```

### –¢–µ–ø–µ—Ä—å (–Ω–æ–≤–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ)

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–ù–∞—á–∞—Ç—å –ø–∞—Ä—Å–∏–Ω–≥"
         ‚Üì
–ü–∞—Ä—Å–µ—Ä —Å–∫—Ä–µ–π–ø–∏—Ç —Å–∞–π—Ç (5000 –æ–±—ä—è–≤–ª–µ–Ω–∏–π)
         ‚Üì
–°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ –ë–î
         ‚Üì
–ó–∞–≥—Ä—É–∂–∞–µ—Ç –í–°–ï –¥–∞–Ω–Ω—ã–µ –∏–∑ –ë–î (5230 –æ–±—ä—è–≤–ª–µ–Ω–∏–π)
         ‚Üì
–†–µ–∑—É–ª—å—Ç–∞—Ç: –í–°–ï –æ–±—ä—è–≤–ª–µ–Ω–∏—è –∏–∑ –ë–î —Å –ø–æ–ª–Ω—ã–º–∏ –ø–æ–ª—è–º–∏!
           (—Å—Ç–∞—Ä—ã–µ + –Ω–æ–≤—ã–µ + –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ)
         ‚Üì
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç: –ø–æ–ª–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ë–î
```

---

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?

### –®–∞–≥ –∑–∞ —à–∞–≥–æ–º

```
1. POST /api/parse
   ‚Üì
   –°–µ—Ä–≤–µ—Ä:
   - –°–æ–∑–¥–∞–µ—Ç —Å–µ—Å—Å–∏—é –ø–∞—Ä—Å–∏–Ω–≥–∞
   - –ó–∞–ø—É—Å–∫–∞–µ—Ç –ø–∞—Ä—Å–µ—Ä –≤ —Ñ–æ–Ω–µ
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç sessionId –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

   ‚Üì (–≤ —Ñ–æ–Ω–µ, –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ)

2. parser.parse()
   ‚Üì
   –ü–∞—Ä—Å–µ—Ä:
   - –ó–∞–≥—Ä—É–∂–∞–µ—Ç —Å–∞–π—Ç —á–µ—Ä–µ–∑ Puppeteer
   - –ü–∞—Ä—Å–∏—Ç HTML —á–µ—Ä–µ–∑ Cheerio
   - –°–æ–±–∏—Ä–∞–µ—Ç –æ–±—ä—è–≤–ª–µ–Ω–∏—è –≤ this.listings
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç

   ‚Üì

3. runParserWithDB()
   ‚Üì
   –ê–¥–∞–ø—Ç–µ—Ä –ø–∞—Ä—Å–µ—Ä–∞:
   - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –æ–±—ä—è–≤–ª–µ–Ω–∏—è –≤ –ë–î
   - –°–æ–∑–¥–∞–µ—Ç/–æ–±–Ω–æ–≤–ª—è–µ—Ç –∑–∞–ø–∏—Å–∏
   - –õ–æ–≥–∏—Ä—É–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É

   ‚Üì

4. db.getListings() ‚Üê –ù–û–í–´–ô –®–ê–ì!
   ‚Üì
   –ë–î:
   - –ó–∞–≥—Ä—É–∂–∞–µ—Ç –í–°–ï –æ–±—ä—è–≤–ª–µ–Ω–∏—è –∏–∑ –ë–î
   - –§–∏–ª—å—Ç—Ä—É–µ—Ç –ø–æ —Ü–µ–Ω–µ/—Ä–µ–≥–∏–æ–Ω—É (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–ª–Ω—ã–µ –∑–∞–ø–∏—Å–∏ —Å –≤—Å–µ–º–∏ –ø–æ–ª—è–º–∏

   ‚Üì

5. session.listings = allListings
   ‚Üì
   –°–µ—Å—Å–∏—è –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è:
   - listings: –í–°–ï –¥–∞–Ω–Ω—ã–µ –∏–∑ –ë–î
   - dbInfo: —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ —Ç–æ–º, —á—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ
   - status: 'completed'

   ‚Üì

6. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç GET /api/sessions/{id}/data
   ‚Üì
   –†–µ–∑—É–ª—å—Ç–∞—Ç:
   - 5230 –æ–±—ä—è–≤–ª–µ–Ω–∏–π –∏–∑ –ë–î
   - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏
   - –í—Å–µ –ø–æ–ª—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –æ–±—ä—è–≤–ª–µ–Ω–∏—è
```

---

## API –ø—Ä–∏–º–µ—Ä—ã

### 1. –ó–∞–ø—É—Å–∫ –ø–∞—Ä—Å–∏–Ω–≥–∞

```bash
POST /api/parse
Content-Type: application/json

{
  "maxPages": 50,
  "minPrice": 100000,
  "maxPrice": 500000,
  "region": "–ú–æ—Å–∫–≤–∞"
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "sessionId": "session_1735404000000_abc123def",
  "status": "started",
  "message": "–ü–∞—Ä—Å–∏–Ω–≥ –Ω–∞—á–∞–ª—Å—è"
}
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ —Ñ–æ–Ω–µ:**
```
‚è±Ô∏è 45 —Å–µ–∫.  - –ü–∞—Ä—Å–∏–Ω–≥ —Å–∞–π—Ç–∞
‚è±Ô∏è 2 —Å–µ–∫.   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î
‚è±Ô∏è 1 —Å–µ–∫.   - –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö –∏–∑ –ë–î
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
‚è±Ô∏è ~48 —Å–µ–∫. - –ü–∞—Ä—Å–∏–Ω–≥ –≥–æ—Ç–æ–≤
```

---

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞

```bash
GET /api/sessions/session_1735404000000_abc123def/status
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "sessionId": "session_1735404000000_abc123def",
  "status": "completed",
  "progress": 100,
  "listingsCount": 5230,
  "duration": "48s",
  "isDifferential": false
}
```

---

### 3. –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–∞—Ä—Å–∏–Ω–≥–∞

```bash
GET /api/sessions/session_1735404000000_abc123def/data
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "sessionId": "session_1735404000000_abc123def",
  "isDifferential": false,
  "count": 5230,
  "database": {
    "totalListingsInDB": 5230,
    "parsedThisTime": 150,
    "saveResult": {
      "success": true,
      "newItems": 150,
      "updatedItems": 45,
      "total": 5195
    }
  },
  "listings": [
    {
      "id": 1,
      "number": "–ê123–í–•77",
      "price": 250000,
      "region": "–ú–æ—Å–∫–≤–∞",
      "status": "active",
      "date_posted": "2025-01-20 10:30:00",
      "date_updated": "2025-01-20 15:45:00",
      "seller": "John Doe",
      "url": "https://autonomera777.net/...",
      "parsed_at": "2025-01-20 15:45:00",
      "updated_at": "2025-01-20 15:45:00"
    },
    {
      "id": 2,
      "number": "–í456DE99",
      "price": 280000,
      "region": "–°–ü–±",
      "status": "active",
      "date_posted": "2025-01-19 14:20:00",
      "date_updated": "2025-01-20 15:40:00",
      "seller": "Maria Sidorova",
      "url": "https://autonomera777.net/...",
      "parsed_at": "2025-01-20 15:40:00",
      "updated_at": "2025-01-20 15:40:00"
    },
    // ... –µ—â–µ 5228 –æ–±—ä—è–≤–ª–µ–Ω–∏–π
  ]
}
```

---

## –ü—Ä–∏–º–µ—Ä—ã –¥–∞–Ω–Ω—ã—Ö

### –¢–∏–ø–∏—á–Ω—ã–π –æ—Ç–≤–µ—Ç –ø—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ

```json
{
  "sessionId": "session_1735404000000_abc123def",
  "isDifferential": false,
  "count": 5230,
  "database": {
    "totalListingsInDB": 5230,
    "parsedThisTime": 150,
    "saveResult": {
      "success": true,
      "sessionId": "session_1735404000000_abc123def",
      "items": 5000,
      "newItems": 150,
      "updatedItems": 45,
      "unchangedItems": 4805
    }
  },
  "listings": [
    {
      "id": 5230,
      "number": "–ó789–ú–•99",
      "price": 180000,
      "region": "–ö–∞–∑–∞–Ω—å",
      "status": "active",
      "date_posted": "2025-01-20 14:15:00",
      "date_updated": null,
      "seller": "Ivan Petrov",
      "url": "https://autonomera777.net/listing/...",
      "parsed_at": "2025-01-20 15:45:00",
      "updated_at": "2025-01-20 15:45:00"
    },
    {
      "id": 5229,
      "number": "–ò101–û–•88",
      "price": 210000,
      "region": "–ú–æ—Å–∫–≤–∞",
      "status": "active",
      "date_posted": "2025-01-20 15:00:00",
      "date_updated": null,
      "seller": "Alexandra Smirnova",
      "url": "https://autonomera777.net/listing/...",
      "parsed_at": "2025-01-20 15:45:00",
      "updated_at": "2025-01-20 15:45:00"
    }
  ]
}
```

### –ö–∞–∫ —á–∏—Ç–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç

```
"count": 5230
  ‚îî‚îÄ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—ä—è–≤–ª–µ–Ω–∏–π –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ (–∏–∑ –ë–î)

"database": {
  "totalListingsInDB": 5230,
    ‚îî‚îÄ –í—Å–µ–≥–æ –æ–±—ä—è–≤–ª–µ–Ω–∏–π –≤ –ë–î –ø–æ—Å–ª–µ –ø–∞—Ä—Å–∏–Ω–≥–∞

  "parsedThisTime": 150,
    ‚îî‚îÄ –°–ø–∞—Ä—Å–µ–Ω–æ –≤ –≠–¢–£ —Å–µ—Å—Å–∏—é (–Ω–æ–≤—ã—Ö + –∏–∑–º–µ–Ω–µ–Ω–Ω—ã—Ö)

  "saveResult": {
    "newItems": 150,
      ‚îî‚îÄ –î–æ–±–∞–≤–ª–µ–Ω–æ –Ω–æ–≤—ã—Ö –æ–±—ä—è–≤–ª–µ–Ω–∏–π
    "updatedItems": 45,
      ‚îî‚îÄ –û–±–Ω–æ–≤–ª–µ–Ω–æ —Ü–µ–Ω—ã –Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö
    "unchangedItems": 4805
      ‚îî‚îÄ –ù–µ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å (—Ü–µ–Ω–∞ —Ç–∞ –∂–µ)
  }
}

"listings": [...]
  ‚îî‚îÄ –í–°–ï –æ–±—ä—è–≤–ª–µ–Ω–∏—è –∏–∑ –ë–î —Å –ø–æ–ª–Ω—ã–º–∏ –ø–æ–ª—è–º–∏
```

---

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

### –ù–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ (JavaScript)

```javascript
// –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–∞—Ä—Å–∏–Ω–≥
async function startParsing() {
  const response = await fetch('/api/parse', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      maxPages: 50,
      minPrice: 100000,
      maxPrice: 500000
    })
  });

  const data = await response.json();
  const sessionId = data.sessionId;

  // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å
  const checkStatus = setInterval(async () => {
    const statusResponse = await fetch(`/api/sessions/${sessionId}/status`);
    const status = await statusResponse.json();

    console.log(`–°—Ç–∞—Ç—É—Å: ${status.status} (${status.progress}%)`);

    if (status.status === 'completed') {
      clearInterval(checkStatus);

      // –ü–æ–ª—É—á–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏–∑ –ë–î
      const resultsResponse = await fetch(`/api/sessions/${sessionId}/data`);
      const results = await resultsResponse.json();

      console.log(`–ò—Ç–æ–≥–æ –æ–±—ä—è–≤–ª–µ–Ω–∏–π –≤ –ë–î: ${results.count}`);
      console.log(`–°–ø–∞—Ä—Å–µ–Ω–æ –≤ —ç—Ç—É —Å–µ—Å—Å–∏—é: ${results.database.parsedThisTime}`);
      console.log(`–ù–æ–≤—ã—Ö –¥–æ–±–∞–≤–ª–µ–Ω–æ: ${results.database.saveResult.newItems}`);

      // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
      displayListings(results.listings);
    }
  }, 2000);
}

// –û—Ç–æ–±—Ä–∞–∑–∏—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏—è
function displayListings(listings) {
  const html = listings.map(listing => `
    <div class="listing">
      <h3>${listing.number}</h3>
      <p>–¶–µ–Ω–∞: ${listing.price.toLocaleString()} —Ä—É–±.</p>
      <p>–†–µ–≥–∏–æ–Ω: ${listing.region}</p>
      <p>–ü—Ä–æ–¥–∞–≤–µ—Ü: ${listing.seller}</p>
      <p>–°—Ç–∞—Ç—É—Å: ${listing.status}</p>
      <p>–û–±–Ω–æ–≤–ª–µ–Ω–æ: ${new Date(listing.updated_at).toLocaleString('ru-RU')}</p>
      <a href="${listing.url}" target="_blank">–°–º–æ—Ç—Ä–µ—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ</a>
    </div>
  `).join('');

  document.getElementById('listings').innerHTML = html;
}

// –ó–∞–ø—É—Å—Ç–∏—Ç—å
startParsing();
```

---

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ–±—ä—è–≤–ª–µ–Ω–∏—è –≤ –ë–î

–ö–∞–∂–¥–æ–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–ª–µ–¥—É—é—â–∏–µ –ø–æ–ª—è:

```javascript
{
  id: 1,                    // —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –≤ –ë–î
  number: "–ê123–í–•77",      // –Ω–æ–º–µ—Ä –æ–±—ä—è–≤–ª–µ–Ω–∏—è
  price: 250000,           // —Ü–µ–Ω–∞ –≤ —Ä—É–±–ª—è—Ö
  region: "–ú–æ—Å–∫–≤–∞",        // —Ä–µ–≥–∏–æ–Ω
  status: "active",        // —Å—Ç–∞—Ç—É—Å (active/inactive)
  date_posted: "2025-01-20 10:30:00",   // –∫–æ–≥–¥–∞ –±—ã–ª–æ —Ä–∞–∑–º–µ—â–µ–Ω–æ
  date_updated: "2025-01-20 15:45:00",  // –ø–æ—Å–ª–µ–¥–Ω–∏–π –∞–ø–¥–µ–π—Ç —Ü–µ–Ω—ã/—Å—Ç–∞—Ç—É—Å–∞
  seller: "John Doe",      // –∏–º—è –ø—Ä–æ–¥–∞–≤—Ü–∞
  url: "https://...",      // –ø—Ä—è–º–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ
  parsed_at: "2025-01-20 15:45:00",     // –∫–æ–≥–¥–∞ –±—ã–ª–æ —Å–ø–∞—Ä—Å–µ–Ω–æ
  updated_at: "2025-01-20 15:45:00"     // –∫–æ–≥–¥–∞ –±—ã–ª–æ –æ–±–Ω–æ–≤–ª–µ–Ω–æ –≤ –ë–î
}
```

---

## üîÑ –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä 1: –ü–æ–ª—É—á–∏—Ç—å —Ç–æ–ª—å–∫–æ –æ–±—ä—è–≤–ª–µ–Ω–∏—è –∏–∑ –ú–æ—Å–∫–≤—ã

```bash
POST /api/parse
{
  "region": "–ú–æ—Å–∫–≤–∞",
  "maxPages": 30
}

# –ó–∞—Ç–µ–º –ø–æ–ª—É—á–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
GET /api/sessions/{sessionId}/data

# –†–µ–∑—É–ª—å—Ç–∞—Ç –±—É–¥–µ—Ç –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω —Ç–æ–ª—å–∫–æ –ú–æ—Å–∫–≤–æ–π!
```

### –ü—Ä–∏–º–µ—Ä 2: –ü–æ–ª—É—á–∏—Ç—å —Ç–æ–ª—å–∫–æ –¥–µ—à–µ–≤—ã–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è

```bash
POST /api/parse
{
  "minPrice": 0,
  "maxPrice": 150000,
  "maxPages": 50
}

# –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –±—É–¥—É—Ç —Ç–æ–ª—å–∫–æ –æ—Ç 0 –¥–æ 150k
```

### –ü—Ä–∏–º–µ—Ä 3: –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ CSV

```bash
GET /api/sessions/{sessionId}/export?format=csv

# –°–∫–∞—á–∏–≤–∞–µ—Ç—Å—è —Ñ–∞–π–ª —Å–æ –≤—Å–µ–º–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏—è–º–∏ –≤ CSV —Ñ–æ—Ä–º–∞—Ç–µ
```

---

## ‚öôÔ∏è –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

### –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ –∫–æ–¥–µ

```javascript
// server.js - POST /api/parse endpoint

// 1. –ó–∞–ø—É—Å–∫–∞–µ–º –ø–∞—Ä—Å–∏–Ω–≥ –≤ —Ñ–æ–Ω–µ
parser.parse().then(async (result) => {
  // 2. –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –ë–î
  const savedData = await runParserWithDB(parser, sessionId);

  // 3. ‚Üê –ì–õ–ê–í–ù–û–ï! –ó–∞–≥—Ä—É–∂–∞–µ–º –í–°–ï –¥–∞–Ω–Ω—ã–µ –∏–∑ –ë–î
  const allListings = await db.getListings({
    minPrice: minPrice,
    maxPrice: maxPrice,
    limit: 100000  // –ø–æ–ª—É—á–∏—Ç—å –≤—Å–µ
  });

  // 4. –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ —Å–µ—Å—Å–∏—é
  session.listings = allListings;  // –í–°–ï –¥–∞–Ω–Ω—ã–µ –∏–∑ –ë–î!
  session.dbInfo = {
    totalInDB: allListings.length,
    parsedThisTime: parser.listings.length,
    savedData: savedData
  };
});
```

### –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ü–µ–Ω–µ/—Ä–µ–≥–∏–æ–Ω—É

```javascript
// –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∫–∞–∑–∞–ª minPrice/maxPrice,
// –æ–Ω–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –≤ db.getListings():

const allListings = await db.getListings({
  minPrice: minPrice === 0 ? 0 : minPrice,
  maxPrice: maxPrice === Infinity ? 999999999 : maxPrice,
  region: region || null,  // –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω —Ä–µ–≥–∏–æ–Ω
  limit: 100000
});

// SQL query (PostgreSQL):
SELECT * FROM listings
WHERE status = 'active'
  AND price >= $1
  AND price <= $2
  [AND region = $3]
ORDER BY updated_at DESC
LIMIT 100000;
```

---

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

```
–ü–∞—Ä—Å–∏–Ω–≥ —Å–∞–π—Ç–∞:          45 —Å–µ–∫.
–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î:         2 —Å–µ–∫.
–ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ –ë–î:          3 —Å–µ–∫.  ‚Üê –ù–û–í–û–ï
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
–ò–¢–û–ì–û:                 ~50 —Å–µ–∫.

–û–±—ä–µ–º –¥–∞–Ω–Ω—ã—Ö:
- –°–ø–∞—Ä—Å–µ–Ω–æ:   5000 –æ–±—ä—è–≤–ª–µ–Ω–∏–π (–ø–∞–º—è—Ç—å –ø–∞—Ä—Å–µ—Ä–∞)
- –í –ë–î:       5230 –æ–±—ä—è–≤–ª–µ–Ω–∏–π (–Ω–∞–∫–æ–ø–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)
- –í–æ–∑–≤—Ä–∞—â–µ–Ω–æ: 5230 –æ–±—ä—è–≤–ª–µ–Ω–∏–π (–≤—Å–µ –∏–∑ –ë–î)
```

---

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–∏

‚úÖ **–ü–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ** ‚Äî –≤—Å–µ –ø–æ–ª—è –æ–±—ä—è–≤–ª–µ–Ω–∏—è –∏–∑ –ë–î
‚úÖ **–ê–∫—Ç—É–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ** ‚Äî –≤—Å–µ–≥–¥–∞ –≤–∏–¥–Ω–æ —á—Ç–æ –≤ –ë–î
‚úÖ **–ò—Å—Ç–æ—Ä–∏—è** ‚Äî —Å—Ç–∞—Ä—ã–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è —Ç–æ–∂–µ –≤–∏–¥–Ω—ã
‚úÖ **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** ‚Äî —Å–∫–æ–ª—å–∫–æ –±—ã–ª–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ/–æ–±–Ω–æ–≤–ª–µ–Ω–æ
‚úÖ **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è** ‚Äî —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –º–æ–∂–Ω–æ —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –ø–æ —Ü–µ–Ω–µ/—Ä–µ–≥–∏–æ–Ω—É
‚úÖ **–≠–∫—Å–ø–æ—Ä—Ç** ‚Äî –º–æ–∂–Ω–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ CSV/Excel

---

**–í–µ—Ä—Å–∏—è:** 1.0
**–î–∞—Ç–∞:** 2025-01-20
