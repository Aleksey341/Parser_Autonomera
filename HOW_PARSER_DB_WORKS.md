# üîÑ –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–∞—Ä—Å–µ—Ä —Å –ë–î

–ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –ø–∞—Ä—Å–µ—Ä–∞ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö.

---

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-—Å–∏—Å—Ç–µ–º—ã)
2. [–ü–æ–ª–Ω—ã–π –ø–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö](#–ø–æ–ª–Ω—ã–π-–ø–æ—Ç–æ–∫-–¥–∞–Ω–Ω—ã—Ö)
3. [–¢—Ä–∏ —Ä–µ–∂–∏–º–∞ —Ä–∞–±–æ—Ç—ã](#—Ç—Ä–∏-—Ä–µ–∂–∏–º–∞-—Ä–∞–±–æ—Ç—ã)
4. [–¢–∞–±–ª–∏—Ü—ã –ë–î](#—Ç–∞–±–ª–∏—Ü—ã-–±–¥)
5. [–°–µ—Å—Å–∏–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞](#—Å–µ—Å—Å–∏–∏-–ø–∞—Ä—Å–∏–Ω–≥–∞)

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                         EXPRESS APP (server.js)                   ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ POST /api/parse                                          ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ POST /api/parse-differential                            ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ GET  /api/sessions/:id/status                           ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ GET  /api/sessions/:id/data                             ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ GET  /api/price-changes                                 ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                  ‚Üì
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ  PARSER (parser.js)         ‚îÇ
                    ‚îÇ - Puppeteer –±—Ä–∞—É–∑–µ—Ä         ‚îÇ
                    ‚îÇ - Cheerio –ø–∞—Ä—Å–∏–Ω–≥ HTML      ‚îÇ
                    ‚îÇ - –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã      ‚îÇ
                    ‚îÇ - –ë–∞—Ç—á-–ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ         ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                  ‚Üì
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ PARSER-DB ADAPTER           ‚îÇ
                    ‚îÇ (parser-db.js)              ‚îÇ
                    ‚îÇ - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏—è–º–∏       ‚îÇ
                    ‚îÇ - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î           ‚îÇ
                    ‚îÇ - –î–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                  ‚Üì
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ         DATABASE LAYER (db.js / db-pg.js)    ‚îÇ
        ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
        ‚îÇ  ‚îÇ MySQL (db.js)‚îÇ  ‚îÇPostgreSQL(db-pg.js) ‚îÇ ‚îÇ
        ‚îÇ  ‚îÇ              ‚îÇ  ‚îÇ                      ‚îÇ ‚îÇ
        ‚îÇ  ‚îÇ connections  ‚îÇ  ‚îÇ connection pooling   ‚îÇ ‚îÇ
        ‚îÇ  ‚îÇ queries      ‚îÇ  ‚îÇ queries              ‚îÇ ‚îÇ
        ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                  ‚Üì
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ              DATABASE                        ‚îÇ
        ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
        ‚îÇ  ‚îÇ listings     ‚îÇ  ‚îÇ parse_sessions       ‚îÇ ‚îÇ
        ‚îÇ  ‚îÇ (–æ–±—ä—è–≤–ª–µ–Ω–∏—è) ‚îÇ  ‚îÇ (–∏—Å—Ç–æ—Ä–∏–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞)  ‚îÇ ‚îÇ
        ‚îÇ  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
        ‚îÇ  ‚îÇ number       ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
        ‚îÇ  ‚îÇ price        ‚îÇ  ‚îÇ price_history        ‚îÇ ‚îÇ
        ‚îÇ  ‚îÇ region       ‚îÇ  ‚îÇ (–∏—Å—Ç–æ—Ä–∏—è —Ü–µ–Ω)        ‚îÇ ‚îÇ
        ‚îÇ  ‚îÇ status       ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
        ‚îÇ  ‚îÇ url          ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
        ‚îÇ  ‚îÇ parsed_at    ‚îÇ  ‚îÇ cron_logs            ‚îÇ ‚îÇ
        ‚îÇ  ‚îÇ updated_at   ‚îÇ  ‚îÇ (–ª–æ–≥–∏ –∞–≤—Ç–æ–ø–∞—Ä—Å–∏–Ω–≥–∞)  ‚îÇ ‚îÇ
        ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## –ü–æ–ª–Ω—ã–π –ø–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö

### –®–∞–≥ 1Ô∏è‚É£: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–∞—Ä—Å–∏–Ω–≥–∞

**–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å:**

```bash
POST /api/parse-differential
{
  "maxPages": 50,
  "minPrice": 100000,
  "maxPrice": 500000
}
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ server.js:**

```javascript
// 1. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID —Å–µ—Å—Å–∏–∏
const sessionId = "session_1735404000000_abc123def";

// 2. –°–æ–∑–¥–∞–µ—Ç—Å—è –ø–∞—Ä—Å–µ—Ä —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
const parser = new AutonomeraParser({
  maxPages: 50,
  minPrice: 100000,
  maxPrice: 500000,
  concurrentRequests: 500
});

// 3. –°–µ—Å—Å–∏—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏
sessions.set(sessionId, {
  parser,
  status: 'running',
  progress: 0,
  startTime: Date.now(),
  isDifferential: true
});

// 4. –í–æ–∑–≤—Ä–∞—â–∞–µ–º ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
res.json({ sessionId, status: 'started' });
```

**–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç:**
```json
{
  "sessionId": "session_1735404000000_abc123def",
  "status": "started",
  "message": "–ü–∞—Ä—Å–∏–Ω–≥ –Ω–∞—á–∞–ª—Å—è"
}
```

---

### –®–∞–≥ 2Ô∏è‚É£: –ó–∞–ø—É—Å–∫ –ø–∞—Ä—Å–∏–Ω–≥–∞

**–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø–∞—Ä—Å–∏–Ω–≥:**

```javascript
// server.js
runDifferentialParserWithDB(parser, sessionId)
  .then(result => { /* —É—Å–ø–µ—Ö */ })
  .catch(error => { /* –æ—à–∏–±–∫–∞ */ });
```

**–í parser-db.js:**

```javascript
async function runDifferentialParserWithDB(parser, sessionId) {
  // 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –±—Ä–∞—É–∑–µ—Ä
  await parser.initBrowser();

  // 2. –°–æ–∑–¥–∞–µ–º —Å–µ—Å—Å–∏—é –≤ –ë–î
  await adapter.startSession({ sessionId });

  // 3. –ó–ê–ü–£–°–ö–ê–ï–ú –ü–ê–†–°–ò–ù–ì
  const result = await parser.parse();

  // 4. –°–†–ê–í–ù–ò–í–ê–ï–ú –° –ë–î (–¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ)
  const diffResult = await adapter.saveDifferentialListingsToDB();

  // 5. –ó–∞–≤–µ—Ä—à–∞–µ–º —Å–µ—Å—Å–∏—é
  await adapter.completeSession();

  // 6. –ó–∞–∫—Ä—ã–≤–∞–µ–º –±—Ä–∞—É–∑–µ—Ä
  await parser.closeBrowser();
}
```

---

### –®–∞–≥ 3Ô∏è‚É£: –ü–∞—Ä—Å–∏–Ω–≥ —Å–∞–π—Ç–∞ (parser.js)

**–ü–∞—Ä—Å–µ—Ä –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Å–∞–π—Ç –∏ —Å–∫—Ä–µ–π–ø–∏—Ç –¥–∞–Ω–Ω—ã–µ:**

```javascript
async parse() {
  console.log('üåê –ü–∞—Ä—Å–∏–º —Å—Ç—Ä–∞–Ω–∏—Ü—É 1...');

  // –û—Ç–∫—Ä—ã–≤–∞–µ–º –±—Ä–∞—É–∑–µ—Ä –∏ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ —Å–∞–π—Ç
  await this.page.goto(this.baseUrl, { waitUntil: 'networkidle2' });

  // –ü–∞—Ä—Å–∏–º –æ–±—ä—è–≤–ª–µ–Ω–∏—è —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
  const listings = await this.page.evaluate(() => {
    return document.querySelectorAll('.listing').map(el => ({
      number: el.querySelector('.number').textContent,
      price: parseInt(el.querySelector('.price').textContent),
      region: el.querySelector('.region').textContent,
      url: el.querySelector('a').href,
      status: 'active'
    }));
  });

  // –î–æ–±–∞–≤–ª—è–µ–º –≤ this.listings
  this.listings = [...this.listings, ...listings];

  // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É (–±–∞—Ç—á–∏ –ø–æ 500)
  // –ï—Å–ª–∏ –¥–æ—Å—Ç–∏–≥–ª–∏ maxPages, –ø–∞—Ä—Å–∏–Ω–≥ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç: this.listings —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ —Å–ø–∞—Ä—Å–µ–Ω–Ω—ã–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è**

```javascript
[
  {
    number: '–ê123–í–•77',
    price: 250000,
    region: '–ú–æ—Å–∫–≤–∞',
    url: 'https://autonomera777.net/...',
    status: 'active'
  },
  {
    number: '–í456DE99',
    price: 300000,
    region: '–°–ü–±',
    url: 'https://autonomera777.net/...',
    status: 'active'
  },
  // ... 5000+ –æ–±—ä—è–≤–ª–µ–Ω–∏–π
]
```

---

### –®–∞–≥ 4Ô∏è‚É£: –î–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ

**–í parser-db.js: saveDifferentialListingsToDB()**

```javascript
async saveDifferentialListingsToDB() {
  // –ü–æ–ª—É—á–∞–µ–º —Å–ø–∞—Ä—Å–µ–Ω–Ω—ã–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è
  const newListings = this.parser.listings; // 5000 –æ–±—ä—è–≤–ª–µ–Ω–∏–π

  // ‚úÖ –ì–õ–ê–í–ù–´–ô –ú–û–ú–ï–ù–¢: –í—ã–∑—ã–≤–∞–µ–º –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ
  const diffResult = await db.getDifferentialListings(
    newListings,
    this.sessionId
  );

  return diffResult;
}
```

**–í db-pg.js: getDifferentialListings()**

```javascript
async getDifferentialListings(newListings, sessionId) {
  // 1Ô∏è‚É£ –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –°–£–©–ï–°–¢–í–£–Æ–©–ò–ï –Ω–æ–º–µ—Ä–∞ –∏–∑ –ë–î
  const existingNumbers = await getExistingNumbers();
  // –†–µ–∑—É–ª—å—Ç–∞—Ç: { '–ê123–í–•77': 250000, '–í456DE99': 280000, ... }

  // 2Ô∏è‚É£ –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º –∫–∞–∂–¥–æ–µ —Å–ø–∞—Ä—Å–µ–Ω–Ω–æ–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ
  const newListingsArray = [];
  const priceChanges = [];

  for (const listing of newListings) {
    const existingPrice = existingNumbers[listing.number];

    if (existingPrice === undefined) {
      // ‚ú® –ù–û–í–û–ï –æ–±—ä—è–≤–ª–µ–Ω–∏–µ! –ï–≥–æ –µ—â–µ –Ω–µ—Ç –≤ –ë–î
      newListingsArray.push(listing);
    } else if (listing.price !== existingPrice) {
      // üìä –¶–µ–Ω–∞ –ò–ó–ú–ï–ù–ò–õ–ê–°–¨! –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –≤ history
      await recordPriceChange(
        listing.number,
        existingPrice,      // —Å—Ç–∞—Ä–∞—è —Ü–µ–Ω–∞
        listing.price,      // –Ω–æ–≤–∞—è —Ü–µ–Ω–∞
        sessionId
      );
      priceChanges.push({
        number: listing.number,
        oldPrice: existingPrice,
        newPrice: listing.price,
        priceDelta: listing.price - existingPrice,
        changeDirection: listing.price > existingPrice ? 'increased' : 'decreased'
      });
    }
    // –û—Å—Ç–∞–ª—å–Ω–æ–µ: —Ü–µ–Ω–∞ –Ω–µ –∏–∑–º–µ–Ω–∏–ª–∞—Å—å, –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º
  }

  // 3Ô∏è‚É£ –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
  return {
    newListings: newListingsArray,        // —Ç–æ–ª—å–∫–æ –ù–û–í–´–ï
    priceChanges: priceChanges,           // —Ç–æ–ª—å–∫–æ –ò–ó–ú–ï–ù–ï–ù–ù–´–ï
    statistics: {
      newCount: newListingsArray.length,
      updatedCount: priceChanges.length,
      unchangedCount: newListings.length - newListingsArray.length - priceChanges.length
    }
  };
}
```

---

### –®–∞–≥ 5Ô∏è‚É£: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î

**–î–ª—è –Ω–æ–≤—ã—Ö –æ–±—ä—è–≤–ª–µ–Ω–∏–π: insertOrUpdateListing()**

```javascript
async insertOrUpdateListing(listingData) {
  // PostgreSQL: ON CONFLICT ... DO UPDATE
  // MySQL: ON DUPLICATE KEY UPDATE

  await db.query(`
    INSERT INTO listings (number, price, region, status, url, parsed_at)
    VALUES ($1, $2, $3, $4, $5, NOW())
    ON CONFLICT (number) DO UPDATE SET
      price = EXCLUDED.price,
      parsed_at = NOW()
  `, [data.number, data.price, ...]);
}
```

**–î–ª—è –∏—Å—Ç–æ—Ä–∏–∏ —Ü–µ–Ω: recordPriceChange()**

```javascript
async recordPriceChange(number, oldPrice, newPrice, sessionId) {
  await db.query(`
    INSERT INTO price_history (number, old_price, new_price, price_delta, change_direction, session_id)
    VALUES ($1, $2, $3, $4, $5, $6)
  `, [number, oldPrice, newPrice, newPrice - oldPrice, direction, sessionId]);
}
```

---

### –®–∞–≥ 6Ô∏è‚É£: –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏

**updateParseSession()**

```javascript
async updateParseSession(sessionId, {
  status: 'completed',
  totalItems: 5000,
  newItems: 150,
  updatedItems: 45,
  unchangedItems: 4805
})

// –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∑–∞–ø–∏—Å—å –≤ –ë–î:
// UPDATE parse_sessions SET status='completed', ...
```

**–û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Å–µ—Å—Å–∏—è –≤ –ø–∞–º—è—Ç–∏:**

```javascript
session.status = 'completed';
session.listings = result.newListings;        // 150 –Ω–æ–≤—ã—Ö
session.priceChanges = result.priceChanges;   // 45 –∏–∑–º–µ–Ω–µ–Ω–∏–π
session.diffResult = result;                  // –ø–æ–ª–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
session.endTime = Date.now();
```

---

### –®–∞–≥ 7Ô∏è‚É£: –í–æ–∑–≤—Ä–∞—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

**–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∞—Ç—É—Å:**

```bash
GET /api/sessions/session_1735404000000_abc123def/status
```

**–ü–æ–ª—É—á–∞–µ—Ç:**

```json
{
  "sessionId": "session_1735404000000_abc123def",
  "status": "completed",
  "isDifferential": true,
  "differential": {
    "totalParsed": 5000,
    "newItems": 150,
    "updatedItems": 45,
    "unchangedItems": 4805,
    "priceChangesCount": 45
  },
  "duration": "45s"
}
```

**–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ:**

```bash
GET /api/sessions/session_1735404000000_abc123def/data
```

**–ü–æ–ª—É—á–∞–µ—Ç:**

```json
{
  "isDifferential": true,
  "count": 150,  // —Ç–æ–ª—å–∫–æ –ù–û–í–´–ï
  "listings": [
    {
      "number": "–ó789–ú–•99",
      "price": 180000,
      "region": "–ö–∞–∑–∞–Ω—å",
      ...
    },
    ...
  ],
  "priceChangesCount": 45,
  "priceChanges": [
    {
      "number": "–ê456DE99",
      "oldPrice": 300000,
      "newPrice": 280000,
      "priceDelta": -20000,
      "changeDirection": "decreased"
    },
    ...
  ],
  "priceChangesSummary": {
    "total": 45,
    "increased": 30,
    "decreased": 15,
    "totalPriceDelta": 125000
  }
}
```

---

## –¢—Ä–∏ —Ä–µ–∂–∏–º–∞ —Ä–∞–±–æ—Ç—ã

### 1Ô∏è‚É£ –û–±—ã—á–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥: `/api/parse`

```
autonomera777.net
        ‚Üì
   parser.parse()
        ‚Üì
  this.listings = [5000 –æ–±—ä—è–≤–ª–µ–Ω–∏–π]
        ‚Üì
  ‚ùå –ë–ï–ó —Å—Ä–∞–≤–Ω–µ–Ω–∏—è!
        ‚Üì
  insertOrUpdateListing() –¥–ª—è –í–°–ï–• 5000
        ‚Üì
  üìä –†–µ–∑—É–ª—å—Ç–∞—Ç:
     - –ù–æ–≤—ã—Ö: 150
     - –û–±–Ω–æ–≤–ª–µ–Ω–æ: 4850 (–ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞–Ω—ã –≤—Å–µ —Ü–µ–Ω—ã)
```

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:** –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫, –ø–æ–ª–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

---

### 2Ô∏è‚É£ –î–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥: `/api/parse-differential`

```
autonomera777.net
        ‚Üì
   parser.parse()
        ‚Üì
  this.listings = [5000 –æ–±—ä—è–≤–ª–µ–Ω–∏–π]
        ‚Üì
  getDifferentialListings()
    ‚îú‚îÄ getExistingNumbers() –∏–∑ –ë–î
    ‚îú‚îÄ –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏
    ‚îú‚îÄ recordPriceChange() –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–Ω—ã—Ö
    ‚îî‚îÄ –í–æ–∑–≤—Ä–∞—Ç —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã—Ö + –∏–∑–º–µ–Ω–µ–Ω–Ω—ã—Ö
        ‚Üì
  insertOrUpdateListing() –¢–û–õ–¨–ö–û –¥–ª—è 150 –Ω–æ–≤—ã—Ö
        ‚Üì
  üìä –†–µ–∑—É–ª—å—Ç–∞—Ç:
     - –ù–æ–≤—ã—Ö: 150 (—Ç–æ–ª—å–∫–æ –¥–æ–±–∞–≤–ª–µ–Ω—ã)
     - –ò–∑–º–µ–Ω–µ–Ω—ã —Ü–µ–Ω—ã: 45 (–≤ price_history)
     - –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π: 4805 (–Ω–µ —Ç—Ä–æ–≥–∞–ª–∏)
```

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:** –†–µ–≥—É–ª—è—Ä–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ü–µ–Ω

---

### 3Ô∏è‚É£ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–∞—Ä—Å–∏–Ω–≥: `scheduler.js`

```
00:00 (–ø–æ–ª–Ω–æ—á—å –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é)
        ‚Üì
  scheduler –∑–∞–ø—É—Å–∫–∞–µ—Ç –ø–∞—Ä—Å–∏–Ω–≥
        ‚Üì
  scheduledParseTask()
        ‚Üì
  runParserWithDB() (–æ–±—ã—á–Ω—ã–π, –Ω–µ –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π)
        ‚Üì
  –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –ª–æ–≥–∏ –≤ cron_logs
        ‚Üì
  üìä –†–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤ –ë–î
```

**–ö–æ–≥–¥–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:** –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 00:00 (–∏–ª–∏ –∫–∞–∫ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ –≤ .env)

---

## –¢–∞–±–ª–∏—Ü—ã –ë–î

### üìã listings (–æ—Å–Ω–æ–≤–Ω—ã–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è)

```
id                INTEGER PRIMARY KEY      –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID
number            VARCHAR(15) UNIQUE       –ê123–í–•77
price             INTEGER                  250000
region            VARCHAR(100)             –ú–æ—Å–∫–≤–∞
status            VARCHAR(50)              'active'/'inactive'
date_posted       TIMESTAMP                2025-01-20 10:30:00
date_updated      TIMESTAMP                2025-01-20 15:45:00
seller            VARCHAR(255)             –ò–º—è –ø—Ä–æ–¥–∞–≤—Ü–∞
url               VARCHAR(500) UNIQUE      https://...
parsed_at         TIMESTAMP                2025-01-20 15:45:00
updated_at        TIMESTAMP                2025-01-20 15:45:00

INDEX: number, region, status, price, updated_at
```

**–ü—Ä–∏–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö:**
```
–ê123–í–•77 | 250000 | –ú–æ—Å–∫–≤–∞ | active | 2025-01-20 15:45:00
–í456DE99 | 280000 | –°–ü–±    | active | 2025-01-20 15:40:00
–ó789–ú–•99 | 180000 | –ö–∞–∑–∞–Ω—å | active | 2025-01-20 15:30:00
```

---

### üìä price_history (–∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π —Ü–µ–Ω)

```
id                SERIAL PRIMARY KEY       –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID
number            VARCHAR(15)              –ê123–í–•77
old_price         INTEGER                  240000
new_price         INTEGER                  250000
price_delta       INTEGER                  10000
change_direction  VARCHAR(20)              'increased'
updated_at        TIMESTAMP                2025-01-20 15:45:00
session_id        VARCHAR(36)              session_1735404000000_abc123def

INDEX: number, updated_at, session_id
```

**–ü—Ä–∏–º–µ—Ä –∏—Å—Ç–æ—Ä–∏–∏:**
```
–ê123–í–•77 | 240000 ‚Üí 250000 | +10000 | increased | 2025-01-20 15:45:00 | session_...
–ê123–í–•77 | 230000 ‚Üí 240000 | +10000 | increased | 2025-01-19 15:45:00 | session_...
–ê123–í–•77 | 200000 ‚Üí 230000 | +30000 | increased | 2025-01-18 15:45:00 | session_...
```

---

### üïê parse_sessions (–∏—Å—Ç–æ—Ä–∏–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞)

```
id                VARCHAR(36) PRIMARY KEY  session_1735404000000_abc123def
started_at        TIMESTAMP                2025-01-20 15:30:00
completed_at      TIMESTAMP                2025-01-20 15:45:00
status            VARCHAR(50)              'completed'/'running'/'failed'
total_items       INTEGER                  5000
new_items         INTEGER                  150
updated_items     INTEGER                  45
params            JSONB                    {"maxPages": 50, "region": null}
error             TEXT                     NULL

INDEX: status, started_at
```

---

### ü§ñ cron_logs (–ª–æ–≥–∏ –∞–≤—Ç–æ–ø–∞—Ä—Å–∏–Ω–≥–∞)

```
id                SERIAL PRIMARY KEY       –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID
scheduled_time    TIMESTAMP                2025-01-20 00:00:00
started_at        TIMESTAMP                2025-01-20 00:00:05
completed_at      TIMESTAMP                2025-01-20 00:15:30
status            VARCHAR(50)              'completed'/'running'/'failed'
items_processed   INTEGER                  3500
error             TEXT                     NULL

INDEX: started_at, status
```

---

## –°–µ—Å—Å–∏–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞

### –í –ø–∞–º—è—Ç–∏ (server.js)

```javascript
// –ü–æ–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥ —Ä–∞–±–æ—Ç–∞–µ—Ç, —Å–µ—Å—Å–∏—è –≤ –ø–∞–º—è—Ç–∏
sessions.set(sessionId, {
  parser: AutonomeraParser { ... },      // —Å–∞–º –ø–∞—Ä—Å–µ—Ä
  status: 'running',                      // —Å—Ç–∞—Ç—É—Å
  progress: 35,                           // –ø—Ä–æ–≥—Ä–µ—Å—Å %
  startTime: 1735404000000,              // –∫–æ–≥–¥–∞ –Ω–∞—á–∞–ª
  endTime: null,                          // –∫–æ–≥–¥–∞ –∑–∞–∫–æ–Ω—á–∏–ª
  isDifferential: true,                   // –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π?
  listings: [],                           // —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
  priceChanges: [],                       // –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ü–µ–Ω
  diffResult: { ... }                     // –ø–æ–ª–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
});
```

### –í –ë–î (parse_sessions)

```
–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Å–µ—Å—Å–∏—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ë–î –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏:

id: session_1735404000000_abc123def
started_at: 2025-01-20 15:30:00
completed_at: 2025-01-20 15:45:00
status: completed
total_items: 5000
new_items: 150
updated_items: 45
params: {"maxPages": 50, "isDifferential": true}
error: NULL
```

---

## –ü–æ–ª–Ω—ã–π –∂–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –æ–±—ä—è–≤–ª–µ–Ω–∏—è

### üÜï –ù–æ–≤–æ–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–º –ø–∞—Ä—Å–∏–Ω–≥–µ

```
1. –ü–∞—Ä—Å–∏–Ω–≥ –Ω–∞—Ö–æ–¥–∏—Ç: –ê999–•–•99, —Ü–µ–Ω–∞ 150000

2. getDifferentialListings() –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:
   "–ï—Å—Ç—å –ª–∏ –ê999–•–•99 –≤ –ë–î?"
   ‚Üí –ù–µ—Ç!

3. –î–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ newListings

4. insertOrUpdateListing() –≤—Å—Ç–∞–≤–ª—è–µ—Ç –≤ –ë–î:
   INSERT INTO listings (number, price, ...)
   VALUES ('–ê999–•–•99', 150000, ...)

5. –û–±—ä—è–≤–ª–µ–Ω–∏–µ —Ç–µ–ø–µ—Ä—å –≤ –ë–î —Å parsed_at = NOW()
```

---

### üìà –û–±—ä—è–≤–ª–µ–Ω–∏–µ —Å –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º —Ü–µ–Ω—ã

```
1. –ü–∞—Ä—Å–∏–Ω–≥ –Ω–∞—Ö–æ–¥–∏—Ç: –ê123–í–•77, —Ü–µ–Ω–∞ 250000

2. getDifferentialListings() –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:
   "–ï—Å—Ç—å –ª–∏ –ê123–í–•77 –≤ –ë–î?"
   ‚Üí –î–∞! –°—Ç–∞—Ä–∞—è —Ü–µ–Ω–∞: 240000

3. –¶–µ–Ω—ã –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç:
   240000 ‚â† 250000

4. recordPriceChange() –≤—Å—Ç–∞–≤–ª—è–µ—Ç –≤ price_history:
   INSERT INTO price_history (number, old_price, new_price, ...)
   VALUES ('–ê123–í–•77', 240000, 250000, 10000, 'increased', ...)

5. insertOrUpdateListing() –æ–±–Ω–æ–≤–ª—è–µ—Ç –æ—Å–Ω–æ–≤–Ω—É—é —Ü–µ–Ω—É:
   UPDATE listings SET price = 250000 WHERE number = '–ê123–í–•77'
```

---

### ‚û°Ô∏è –û–±—ä—è–≤–ª–µ–Ω–∏–µ –ë–ï–ó –∏–∑–º–µ–Ω–µ–Ω–∏–π

```
1. –ü–∞—Ä—Å–∏–Ω–≥ –Ω–∞—Ö–æ–¥–∏—Ç: –í456DE99, —Ü–µ–Ω–∞ 280000

2. getDifferentialListings() –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:
   "–ï—Å—Ç—å –ª–∏ –í456DE99 –≤ –ë–î?"
   ‚Üí –î–∞! –°—Ç–∞—Ä–∞—è —Ü–µ–Ω–∞: 280000

3. –¶–µ–Ω—ã —Å–æ–≤–ø–∞–¥–∞—é—Ç:
   280000 = 280000

4. –ù–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º! –û–±—ä—è–≤–ª–µ–Ω–∏–µ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è.
```

---

## API –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º

### –í–æ –≤—Ä–µ–º—è –ø–∞—Ä—Å–∏–Ω–≥–∞

```
GET /api/sessions/{sessionId}/status
‚Üí –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å, —Å–∫–æ–ª—å–∫–æ —É–∂–µ —Å–ø–∞—Ä—Å–µ–Ω–æ
```

### –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

```
GET /api/sessions/{sessionId}/data
‚Üí –¢–æ–ª—å–∫–æ –ù–û–í–´–ï –æ–±—ä—è–≤–ª–µ–Ω–∏—è + –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ü–µ–Ω

GET /api/price-changes?days=7
‚Üí –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ü–µ–Ω –∑–∞ 7 –¥–Ω–µ–π

GET /api/price-history/{number}
‚Üí –ò—Å—Ç–æ—Ä–∏—è —Ü–µ–Ω –¥–ª—è –æ–¥–Ω–æ–≥–æ –æ–±—ä—è–≤–ª–µ–Ω–∏—è

GET /api/price-changes/stats?days=7
‚Üí –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: —Å–∫–æ–ª—å–∫–æ —Ü–µ–Ω –≤—ã—Ä–æ—Å–ª–æ/—É–ø–∞–ª–æ
```

---

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

### –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤

**–û–±—ã—á–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥:**
```
5000 –æ–±—ä—è–≤–ª–µ–Ω–∏–π √ó 5000 INSERT/UPDATE = 5000 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –ë–î
```

**–î–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥:**
```
1 –∑–∞–ø—Ä–æ—Å: SELECT –≤—Å–µ –Ω–æ–º–µ—Ä–∞ (—Å –∏–Ω–¥–µ–∫—Å–æ–º –±—ã—Å—Ç—Ä–æ!)
150 INSERT –¥–ª—è –Ω–æ–≤—ã—Ö
45 INSERT –≤ price_history –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
= ~195 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤–º–µ—Å—Ç–æ 5000! ‚úÖ
```

### –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ—Å—Ç—å

**parser.js:**
```javascript
concurrentRequests: 500  // 500 –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ —Å–∞–π—Ç—É
requestDelayMs: 50       // 50ms –∑–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –≤–æ–ª–Ω–∞–º–∏
```

**db.js / db-pg.js:**
```javascript
pool: { max: 10 }        // 10 –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –∫ –ë–î
```

---

## –û—à–∏–±–∫–∏ –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ

### –ï—Å–ª–∏ —Å–±–æ–π –≤–æ –≤—Ä–µ–º—è –ø–∞—Ä—Å–∏–Ω–≥–∞

```
1. –°–µ—Å—Å–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –≤ –ø–∞–º—è—Ç–∏
2. –ï—Å–ª–∏ –±—ã–ª–∏ –±–∞—Ç—á–∏ ‚Äî –º–æ–∂–Ω–æ –≤—ã–∑–≤–∞—Ç—å:
   POST /api/sessions/{sessionId}/continue
3. –ï—Å–ª–∏ –Ω–µ—É–¥–∞—á–∞ –ø–æ–ª–Ω–∞—è:
   DELETE /api/sessions/{sessionId}
```

### –ï—Å–ª–∏ —Å–±–æ–π –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –≤ –ë–î

```javascript
try {
  await db.insertOrUpdateListing(data);
} catch (error) {
  console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—Å—Ç–∞–≤–∫–µ:', error);
  // –°–µ—Å—Å–∏—è –≤—Å–µ —Ä–∞–≤–Ω–æ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç—É
  // –ü—Ä–æ—Å—Ç–æ —ç—Ç–æ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è
}
```

---

## üéØ –û—Å–Ω–æ–≤–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

1Ô∏è‚É£ **–ü–∞—Ä—Å–µ—Ä** ‚Äî –ø–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ —Å —Å–∞–π—Ç–∞
2Ô∏è‚É£ **Parser-DB Adapter** ‚Äî —É–ø—Ä–∞–≤–ª—è–µ—Ç —Å–µ—Å—Å–∏—è–º–∏ –∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ–º
3Ô∏è‚É£ **–ë–î —Å–ª–æ–π** ‚Äî —Ö—Ä–∞–Ω–∏—Ç –∏ —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ
4Ô∏è‚É£ **–¢–∞–±–ª–∏—Ü—ã** ‚Äî listings (–æ—Å–Ω–æ–≤–Ω—ã–µ), price_history (–∏–∑–º–µ–Ω–µ–Ω–∏—è), parse_sessions (–∏—Å—Ç–æ—Ä–∏–∏), cron_logs (–∞–≤—Ç–æ–ø–∞—Ä—Å–∏–Ω–≥)
5Ô∏è‚É£ **–°–µ—Å—Å–∏–∏** ‚Äî –≤ –ø–∞–º—è—Ç–∏ –≤–æ –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã, –≤ –ë–î –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏

---

**–í–µ—Ä—Å–∏—è:** 1.0
**–î–∞—Ç–∞:** 2025-01-20
