-- ============================================================================
-- МВП-аналитика: Инициализация шкал показателей по методике v1
-- ============================================================================

-- ============================================================================
-- РАЗДЕЛ 1: Детальные шкалы для каждого публичного показателя
-- ============================================================================

-- PUB_001: Поддержка руководства (0-3)
INSERT INTO map_scale (version_id, ind_id, threshold_min, threshold_max, score) VALUES
('v1', 1, 0, 33.33, 0),
('v1', 1, 33.34, 66.66, 1.5),
('v1', 1, 66.67, 100, 3);

-- PUB_002: Выполнение задач АГП (0-5)
-- Шкала: 0-50% (0), 51-60% (1), 61-70% (2), 71-80% (3), 81-90% (4), 91-100% (5)
INSERT INTO map_scale (version_id, ind_id, threshold_min, threshold_max, score) VALUES
('v1', 2, 0, 50, 0),
('v1', 2, 50.01, 60, 1),
('v1', 2, 60.01, 70, 2),
('v1', 2, 70.01, 80, 3),
('v1', 2, 80.01, 90, 4),
('v1', 2, 90.01, 100, 5);

-- PUB_003: Позиционирование главы (0-3)
-- Шкала: функционер/хозяйственник (3), размытое (0)
-- Используется категориальное значение, логика в calc-scoring.js

-- PUB_004: Проектная деятельность (0-3)
-- Шкала: 1 рег + 1 мун (3), только 1 рег (2), только 1 мун (1), нет (0)
-- Используется категориальное значение, логика в calc-scoring.js

-- PUB_005: Доля молодёжи в добровольчестве (0-3)
-- Шкала: 0-15% (0), 16-25% (1), 26-50% (2), >50% (3)
INSERT INTO map_scale (version_id, ind_id, threshold_min, threshold_max, score) VALUES
('v1', 5, 0, 15, 0),
('v1', 5, 15.01, 25, 1),
('v1', 5, 25.01, 50, 2),
('v1', 5, 50.01, 100, 3);

-- PUB_006: Активные в Движении Первых 6-18 (0-3)
-- Аналогично добровольчеству
INSERT INTO map_scale (version_id, ind_id, threshold_min, threshold_max, score) VALUES
('v1', 6, 0, 15, 0),
('v1', 6, 15.01, 25, 1),
('v1', 6, 25.01, 50, 2),
('v1', 6, 50.01, 100, 3);

-- PUB_007: Личная вовлечённость главы (0-3)
-- Категориальная, логика в calc-scoring.js (частота встреч, решённые проблемы)

-- PUB_008: Кадровый резерв (0-3)
-- Шкала: <30% (0), 30-49% (1), 50-79% (2), 80-100% (3)
INSERT INTO map_scale (version_id, ind_id, threshold_min, threshold_max, score) VALUES
('v1', 8, 0, 30, 0),
('v1', 8, 30.01, 49, 1),
('v1', 8, 49.01, 79, 2),
('v1', 8, 79.01, 100, 3);

-- PUB_009: Эффективность грантов (0-3)
-- Логика: 0 побед (0), 1-2 победы или ≥1млн (1), ≥3 побед подряд или ≥10млн (3), нарушения (0)
-- Категориальная, логика в calc-scoring.js


-- ============================================================================
-- РАЗДЕЛ 2: Шкалы для закрытых показателей
-- ============================================================================

-- CLOSED_001: Партийное мнение (0-6)
-- Члены 0-3 + сторонники 0-3 = 0-6
-- Логика в calc-scoring.js

-- CLOSED_002: Альтернативное мнение (0/2/4)
-- Логика в calc-scoring.js: 100% (4), 94% (2), <94% (0)

-- CLOSED_003: АГП уровень (0/3/5)
-- Логика в calc-scoring.js: не выполнен (0), выполнен (3), превышен ≤10% (5)

-- CLOSED_004: АГП качество (0/3/5)
-- Аналогично уровню

-- CLOSED_005: Экономическая привлекательность (1/2/3)
INSERT INTO map_scale (version_id, ind_id, threshold_min, threshold_max, score) VALUES
('v1', 14, 1, 1, 3),    -- низкая (высокий балл)
('v1', 14, 2, 2, 2),    -- средняя
('v1', 14, 3, 3, 1);    -- высокая (низкий балл)

-- CLOSED_006: Общественно-политическая деятельность ветеранов (0-6)
-- Члены 0-3 + сторонники 0-3

-- CLOSED_007: Представители в "Гордость Липецкой земли" (0/2)
-- Логика в calc-scoring.js: есть (2), нет (0)


-- ============================================================================
-- РАЗДЕЛ 3: Шкалы штрафных критериев
-- ============================================================================

-- PENALTY_001: Конфликты с региональной властью
INSERT INTO map_scale (version_id, pen_id, threshold_min, threshold_max, score) VALUES
('v1', 1, 0, 0, 0),      -- нет конфликта
('v1', 1, 1, 2, -2),     -- спор с властью
('v1', 1, 3, 10, -3);    -- открытое противостояние

-- PENALTY_002: Внутримуниципальные конфликты
INSERT INTO map_scale (version_id, pen_id, threshold_min, threshold_max, score) VALUES
('v1', 2, 0, 0, 0),      -- нет
('v1', 2, 1, 1, -1),     -- редкие, низкий резонанс
('v1', 2, 2, 3, -2),     -- периодические, средний резонанс
('v1', 2, 4, 10, -3);    -- частые, высокий резонанс

-- PENALTY_003: ПО и репутационные потери
INSERT INTO map_scale (version_id, pen_id, threshold_min, threshold_max, score) VALUES
('v1', 3, 0, 0, 0),           -- ничего
('v1', 3, 1, 1, -2),          -- административное дело
('v1', 3, 2, 2, -3),          -- тяжкое преступление в администрации
('v1', 3, 3, 10, -5);         -- уголовное преследование главы

-- ============================================================================
-- РАЗДЕЛ 4: Выверка справочников (все коды и названия)
-- ============================================================================

-- Справочник индикаторов (17 критериев)
SELECT '=== СПРАВОЧНИК ИНДИКАТОРОВ ===' AS section;
SELECT ind_id, ind_code, display_name, is_public FROM dim_indicators ORDER BY ind_id;

-- Справочник штрафов
SELECT '=== СПРАВОЧНИК ШТРАФОВ ===' AS section;
SELECT pen_id, pen_code, display_name FROM dim_penalties;

-- Справочник версий методики
SELECT '=== ВЕРСИИ МЕТОДИКИ ===' AS section;
SELECT version_id, version_name, valid_from, valid_to, is_active FROM dim_methodology_versions;

-- Справочник источников
SELECT '=== ИСТОЧНИКИ ДАННЫХ ===' AS section;
SELECT source_id, org_name, contact_email, channel, sla_days FROM src_registry;

-- Школы интегральной оценки
SELECT '=== ИНТЕГРАЛЬНАЯ ШКАЛА (СВЕТОФОР) ===' AS section;
SELECT version_id, zone_name, color_hex, threshold_min, threshold_max FROM map_scale
WHERE version_id = 'v1' AND zone_name IS NOT NULL
ORDER BY threshold_min;

-- ============================================================================
-- РАЗДЕЛ 5: Проверка целостности
-- ============================================================================

-- Проверка: все индикаторы должны быть в шаблонах Excel
-- (это можно запустить после создания шаблонов)

-- Проверка: каждый источник должен быть ответственен за набор показателей
SELECT '=== МАППИНГ ПОКАЗАТЕЛЕЙ НА ИСТОЧНИКИ ===' AS section;
SELECT DISTINCT owner_org FROM dim_indicators ORDER BY owner_org;

-- ============================================================================
-- ЗАВЕРШЕНИЕ
-- ============================================================================

COMMIT;
